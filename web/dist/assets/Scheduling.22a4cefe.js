import{f as S,p as X}from"./api.ae6dea3f.js";import{r as i,m as Z,b as s,c as ee,o as f,j as C,f as e,e as t,F as M,i as E,l as z,g as w,w as T,d as Y,E as R}from"./index.a78e2dbf.js";const j=c=>{var o=new Date(c),v=o.getFullYear(),g=o.getMonth()+1,m=o.getDate();return v+"-"+g+"-"+m},le=c=>{var o=new Date(Date.parse(c));switch(o.getDay()){case 0:return 7;default:return o.getDay()}},ae=(c,o)=>c<o,te=c=>{var o=new Date(Date.parse(c)),v=o.getFullYear(),g=o.getMonth()+1,m=o.getDate()+1;return v+"-"+g+"-"+m},ne=E("div",{style:{"margin-top":"40px"}},null,-1),oe=E("div",{style:{"margin-top":"20px"}},null,-1),re={class:"dialog-footer"},se={__name:"Scheduling",setup(c){const o=i(!1),v=i({}),g=i([]),m=i([]),k=i(""),y=i(""),D=i(["",""]),I=i(10),q=[10,20,30,50],h=i(!1),r=i({deptId:"",start:"",end:"",ndate:["",""],ruleSelection:[]}),$=i([]);function L(){new Date(r.value.ndate[0]),new Date(r.value.ndate[1]),r.value.ruleSelection.forEach((n,l)=>{for(var u=new Date(r.value.ndate[0]),V=new Date(r.value.ndate[1]);ae(u,V);){var p=le(u);n.week[(p-1)*2]==1&&$.value.push({id:0,schedDate:j(u),deptID:r.value.deptId,ruleID:n.id,userID:n.userID,noon:"\u4E0A\u5348"}),n.week[(p-1)*2+1]==1&&$.value.push({id:0,schedDate:j(u),deptID:r.value.deptId,ruleID:n.id,userID:n.userID,noon:"\u4E0B\u5348"}),u=new Date(te(u))}}),X("/scheduling/add",$.value).then(n=>{n.data.result?(h.value=!1,_(v.value.current),R.alert("\u6DFB\u52A0\u6210\u529F","\u63D0\u793A",{})):(n.result.errMsg=="\u672A\u767B\u5F55"&&router.push("/login"),R.alert(n.data.errMsg,"\u63D0\u793A",{}))})}Z(async()=>{_(1),O()});async function O(){const l=await S("/department/page?&count=200&pn=1",null);l.result?g.value=l.data.records:l.errMsg=="\u672A\u767B\u5F55"&&router.push("/login")}async function _(n){o.value=!0;let l=`/scheduling/page?count=${I.value}&pn=${n}`;k!=""&&(l+=`&keyword=${k.value}`),y!=""&&(l+=`&deptId=${y.value}`),D.value[0]!=""&&D.value[1]!=""&&(l+=`&start=${D.value[0]}&end=${D.value[1]}`);const u=await S(l,null);u.result?(v.value=u.data,o.value=!1):u.errMsg=="\u672A\u767B\u5F55"&&router.push("/login")}async function Q(){o.value=!0;let n="/rule/page?count=1000&pn=1";y!=""&&(n+=`&deptId=${r.value.deptId}`);const l=await S(n,null);l.result?(m.value=l.data.records,o.value=!1):l.errMsg=="\u672A\u767B\u5F55"&&router.push("/login")}function A(n){_(n)}function G(n){r.value.ruleSelection=n}return(n,l)=>{const u=s("el-option"),V=s("el-select"),p=s("el-col"),U=s("el-date-picker"),H=s("el-input"),b=s("el-button"),x=s("el-row"),d=s("el-table-column"),B=s("el-table"),J=s("el-pagination"),N=s("el-form-item"),K=s("el-form"),P=s("el-dialog"),F=ee("loading");return f(),C(M,null,[e(x,null,{default:t(()=>[e(p,{span:3,style:{"padding-right":"20px"}},{default:t(()=>[e(V,{modelValue:y.value,"onUpdate:modelValue":l[0]||(l[0]=a=>y.value=a),class:"m-2",filterable:"",clearable:"",onClear:l[1]||(l[1]=a=>_(1)),placeholder:"\u6240\u5C5E\u79D1\u5BA4",onChange:l[2]||(l[2]=a=>_(1))},{default:t(()=>[(f(!0),C(M,null,z(g.value,a=>(f(),Y(u,{key:a.id,label:a.deptCode+a.deptName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{span:8,style:{"padding-right":"20px"}},{default:t(()=>[e(U,{modelValue:D.value,"onUpdate:modelValue":l[3]||(l[3]=a=>D.value=a),type:"daterange","range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date",size:n.size,format:"YYYY/MM/DD","value-format":"YYYY-MM-DD"},null,8,["modelValue","size"])]),_:1}),e(p,{span:4,style:{"padding-right":"20px"}},{default:t(()=>[e(H,{modelValue:k.value,"onUpdate:modelValue":l[4]||(l[4]=a=>k.value=a),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D\u6216\u6392\u73ED\u540D",class:"w-100 m-2"},null,8,["modelValue"])]),_:1}),e(p,{span:4},{default:t(()=>[e(b,{type:"primary",onClick:l[5]||(l[5]=a=>_(1))},{default:t(()=>[w("\u67E5\u8BE2")]),_:1})]),_:1}),e(p,{span:2}),e(p,{span:3},{default:t(()=>[e(b,{type:"danger",onClick:l[6]||(l[6]=a=>h.value=!0)},{default:t(()=>[w("\u65B0\u589E\u6392\u73ED\u8BA1\u5212")]),_:1})]),_:1})]),_:1}),ne,e(x,{class:"m-2"},{default:t(()=>[e(p,{span:24},{default:t(()=>[T((f(),Y(B,{data:v.value.records,style:{width:"100%"}},{default:t(()=>[e(d,{fixed:"",prop:"id",label:"\u5E8F\u53F7",width:"80",align:"center"}),e(d,{prop:"schedDate",label:"\u65E5\u671F",align:"center"}),e(d,{prop:"deptName",label:"\u6240\u5C5E\u79D1\u5BA4",align:"center"}),e(d,{prop:"realName",label:"\u59D3\u540D",align:"center"}),e(d,{prop:"noon",label:"\u5348\u522B",align:"center"}),e(d,{prop:"registName",label:"\u6302\u53F7\u7EA7\u522B",align:"center"}),e(d,{prop:"registQuota",label:"\u6302\u53F7\u9650\u989D",align:"center"}),e(d,{fixed:"right",label:"Operations",align:"center"},{default:t(a=>[e(b,{link:"",type:"primary",onClick:W=>n.showEdit(a.row)},{default:t(()=>[w("\u7F16\u8F91")]),_:2},1032,["onClick"]),e(b,{link:"",type:"danger",onClick:W=>n.del(a.row.id)},{default:t(()=>[w("\u5220\u9664")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[F,o.value]])]),_:1})]),_:1}),oe,e(x,null,{default:t(()=>[e(p,{span:20},{default:t(()=>[e(J,{background:"",layout:"prev, pager, next",total:v.value.total,"page-count":v.value.pages,onCurrentChange:A},null,8,["total","page-count"])]),_:1}),e(p,{span:4},{default:t(()=>[e(V,{modelValue:I.value,"onUpdate:modelValue":l[7]||(l[7]=a=>I.value=a),class:"m-2",placeholder:"\u6BCF\u9875\u884C\u6570",onChange:l[8]||(l[8]=a=>_(1))},{default:t(()=>[(f(),C(M,null,z(q,a=>e(u,{key:a,label:a,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(P,{modelValue:h.value,"onUpdate:modelValue":l[13]||(l[13]=a=>h.value=a),title:"\u65B0\u589E",onClose:n.closeDialog},{footer:t(()=>[E("span",re,[e(b,{onClick:l[12]||(l[12]=a=>h.value=!1)},{default:t(()=>[w("\u53D6\u6D88")]),_:1}),e(b,{type:"primary",disabled:r.value.ruleSelection.length==0,onClick:L},{default:t(()=>[w(" \u65B0\u589E\u6392\u73ED\u8BA1\u5212 ")]),_:1},8,["disabled"])])]),default:t(()=>[e(K,{model:r.value,rules:m.value,"label-width":"100"},{default:t(()=>[e(N,{label:"\u6240\u5C5E\u79D1\u5BA4",prop:"deptID"},{default:t(()=>[e(V,{modelValue:r.value.deptId,"onUpdate:modelValue":l[9]||(l[9]=a=>r.value.deptId=a),class:"m-2",filterable:"",clearable:"",placeholder:"\u6240\u5C5E\u79D1\u5BA4",onChange:l[10]||(l[10]=a=>Q(1))},{default:t(()=>[(f(!0),C(M,null,z(g.value,a=>(f(),Y(u,{key:a.id,label:a.deptCode+a.deptName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(N,{label:"\u6392\u73ED\u89C4\u5219",prop:""},{default:t(()=>[T((f(),Y(B,{data:m.value,style:{width:"100%"},onSelectionChange:G},{default:t(()=>[e(d,{type:"selection",width:"50",align:"left"}),e(d,{prop:"ruleName",label:"\u89C4\u5219\u540D\u79F0",align:"center"}),e(d,{prop:"deptName",label:"\u6240\u5C5E\u79D1\u5BA4",align:"center"}),e(d,{prop:"realName",label:"\u59D3\u540D",align:"center"}),e(d,{prop:"week",label:"\u89C4\u5219",width:"150",align:"center"})]),_:1},8,["data"])),[[F,o.value]])]),_:1}),e(N,{label:"\u65E5\u671F",prop:"newDate"},{default:t(()=>[e(U,{modelValue:r.value.ndate,"onUpdate:modelValue":l[11]||(l[11]=a=>r.value.ndate=a),type:"daterange","range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date",size:n.size,format:"YYYY/MM/DD","value-format":"YYYY-MM-DD"},null,8,["modelValue","size"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"])],64)}}};export{se as default};
